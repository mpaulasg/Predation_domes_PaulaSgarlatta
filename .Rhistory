rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(dplyr)
library(glmmTMB)
library(car)
library(DHARMa)
library(emmeans)
library(here)
data <- read.csv("data_predation_squidpops.csv")
data <- read.csv("data/data_predation_squidpops.csv")
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(dplyr)
library(mvabund)
library(car)
library(DHARMa)
library(emmeans)
library(here)
data <- read.csv("data/data_predation_squidpops.csv")
data_domes <- data %>%
filter (Method != "Squidpop",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)  # Deleting treatment as no fish = 0
data_domes <- data %>%
filter (Method != "Squidpop",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)  # Deleting treatment as no fish = 0
attack <- data_domes %>%
dplyr::group_by(Area,Site, Replicate,Time, Trophic.group)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site, Replicate,Time),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
inspecting <- data_domes %>%
dplyr::group_by(Area,Site,Replicate,Time,Trophic.group)%>%
dplyr::summarise(inspecting=sum(inspecting_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site,Replicate,Time),fill= list(inspecting=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
data_squid <- data %>%
filter (Area != "Lizard Island",
Site != "Malabar 1 ",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)
attack_squid <- data_squid %>%
dplyr::group_by(Method,Site,Replicate,Time,Trophic.group)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_number,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Method, Site,Replicate,Time),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
inspecting_squid <- data_squid %>%
dplyr::group_by(Method,Site,Replicate,Time, Trophic.group)%>%
dplyr::summarise(inspecting=sum(inspecting_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Method,Site,Replicate,Time),fill= list(inspecting=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
attack_dome_stats <- attack %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = attack) %>%
dplyr::select(-row) %>%
replace(is.na(.),0) %>%
dplyr:: select(-Invertivore, -Planktivore)
View(attack_dome_stats)
categories <- mvabund(attack_dome_stats[, 5:7])
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories, horizontal = TRUE, las = 2, main = "Points")
meanvar.plot(categories)
plot(categories ~ as.factor(attack_dome_stats$Area), cex.axis = 0.4, cex = 0.4)
mod1 <- manyglm(categories ~ attack_dome_stats$Area, family = "poisson")
plot(mod1)
mod2 <- manyglm(categories ~ attack_dome_stats$Area, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #Significant effect of area - p = 0.002
test <- anova(mod2, p.uni = "adjusted")
#Adding an ID variable (rows with same ID, are same sample- different species)
data = mutate(data , id =  paste(Area, Site,  Replicate, Time, sep = "_"))
data_domes <- data %>%
filter (Method != "Squidpop",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)  # Deleting treatment as no fish = 0
attack <- data_domes %>%
dplyr::group_by(Area,Site, Replicate,Time, Trophic.group)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site, Replicate,Time),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
View(attack)
attack <- data_domes %>%
dplyr::group_by(Area,Site, Replicate,Time, Trophic.group, id)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site, Replicate,Time, id),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
View(attack)
inspecting <- data_domes %>%
dplyr::group_by(Area,Site,Replicate,Time,Trophic.group, id)%>%
dplyr::summarise(inspecting=sum(inspecting_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site,Replicate,Time, id),fill= list(inspecting=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
data_squid <- data %>%
filter (Area != "Lizard Island",
Site != "Malabar 1 ",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)
attack_squid <- data_squid %>%
dplyr::group_by(Method,Site,Replicate,Time,Trophic.group, id)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_number,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Method, Site,Replicate,Time, id),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
inspecting_squid <- data_squid %>%
dplyr::group_by(Method,Site,Replicate,Time, Trophic.group, id)%>%
dplyr::summarise(inspecting=sum(inspecting_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Method,Site,Replicate,Time, id),fill= list(inspecting=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
attack_dome_stats <- attack %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = attack) %>%
dplyr::select(-row) %>%
replace(is.na(.),0) %>%
dplyr:: select(-Invertivore, -Planktivore)
categories <- mvabund(attack_dome_stats[, 6:8])
categories
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories, horizontal = TRUE, las = 2, main = "Points")
meanvar.plot(categories)
plot(categories ~ as.factor(attack_dome_stats$Area), cex.axis = 0.4, cex = 0.4)
mod1 <- manyglm(categories ~ attack_dome_stats$Area, family = "poisson")
plot(mod1)
mod2 <- manyglm(categories ~ attack_dome_stats$Area, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #Significant effect of area - p = 0.002
test <- anova(mod2, p.uni = "adjusted")
test
investig_dome_stats <- inspecting %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = inspecting) %>%
dplyr::select(-row) %>%
replace(is.na(.),0)
View(investig_dome_stats)
categories_inv <- mvabund(investig_dome_stats[, 6:10])
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories_inv, horizontal = TRUE, las = 2, main = "Points")
meanvar.plot(categories_inv)
plot(categories_inv ~ as.factor(investig_dome_stats$Area), cex.axis = 0.4, cex = 0.4)
mod1 <- manyglm(categories_inv ~ investig_dome_stats$Area, family = "poisson")
plot(mod1)
mod2 <- manyglm(categories_inv ~ investig_dome_stats$Area, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #Significant effect of area - p = 0.001
test <- anova(mod2, p.uni = "adjusted")
test
attack_squid_stats <- attack_squid %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = attack) %>%
dplyr::select(-row) %>%
replace(is.na(.),0) %>%
dplyr::select(-Invertivore)
categories_attack_squid <- mvabund(attack_squid_stats[, 5:7])
View(attack_squid_stats)
View(attack)
View(attack_squid_stats)
categories_attack_squid <- mvabund(attack_squid_stats[, 6:8])
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories_attack_squid, horizontal = TRUE, las = 2, main = "Points")
meanvar.plot(categories_attack_squid)
plot(categories_attack_squid ~ as.factor(attack_squid_stats$Method), cex.axis = 0.4, cex = 0.4)
mod1 <- manyglm(categories_attack_squid ~ attack_squid_stats$Method, family = "poisson")
plot(mod1)
mod2 <- manyglm(categories_attack_squid ~ attack_squid_stats$Method, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #No Significant effect of methods - p = 0.05, which doesn't make sense...
test <- anova(mod2, p.uni = "adjusted")
test
inspect_squid_stats <- inspecting_squid %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = inspecting) %>%
dplyr::select(-row) %>%
replace(is.na(.),0)
categories_inspect_squid <- mvabund(inspect_squid_stats[, 5:8])
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories_inspect_squid, horizontal = TRUE, las = 2, main = "Points")
meanvar.plot(categories_inspect_squid)
plot(categories_inspect_squid ~ as.factor(inspect_squid_stats$Method), cex.axis = 0.4, cex = 0.4)
mod1 <- manyglm(categories_inspect_squid ~ inspect_squid_stats$Method, family = "poisson")
plot(mod1)
mod2 <- manyglm(categories_inspect_squid ~ inspect_squid_stats$Method, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #No significant effect of methods - p = 0.05, which doesn't make sense
test <- anova(mod2, p.uni = "adjusted")
test
rm(list=ls()) # cleaning memory
# libraries
library(tidyverse)
library(dplyr)
library(mvabund)
library(car)
library(DHARMa)
library(emmeans)
library(here)
data <- read.csv("data/data_predation_squidpops.csv")
#Adding an ID variable (rows with same ID, are same sample- different species)
data = mutate(data , id =  paste(Area, Site,  Replicate, Time, sep = "_"))
#Filter first for dome comparison
data_domes <- data %>%
filter (Method != "Squidpop",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)  # Deleting treatment as no fish = 0
attack <- data_domes %>%
dplyr::group_by(Area,Site, Replicate,Time, Trophic.group, id)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site, Replicate,Time, id),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
inspecting <- data_domes %>%
dplyr::group_by(Area,Site,Replicate,Time,Trophic.group, id)%>%
dplyr::summarise(inspecting=sum(inspecting_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Area, Site,Replicate,Time, id),fill= list(inspecting=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
### Now comparing with squidpops
data_squid <- data %>%
filter (Area != "Lizard Island",
Site != "Malabar 1 ",
Treatment != "No_fish") %>%
dplyr::select(-Treatment)
attack_squid <- data_squid %>%
dplyr::group_by(Method,Site,Replicate,Time,Trophic.group, id)%>% # sum everything in the transect by species
dplyr::summarise(attack=sum(attack_number,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Method, Site,Replicate,Time, id),fill= list(attack=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
inspecting_squid <- data_squid %>%
dplyr::group_by(Method,Site,Replicate,Time, Trophic.group, id)%>%
dplyr::summarise(inspecting=sum(inspecting_hour,na.rm=T))%>%
ungroup%>%
tidyr::complete(Trophic.group, nesting(Method,Site,Replicate,Time, id),fill= list(inspecting=0)) %>%
replace(is.na(.), 0)%>% # replace the NaN resulting from dividing 0 by 0 for 0
glimpse()
### Attacks - domes
# # Pivot_wider the data to use it in mvabund
attack_dome_stats <- attack %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = attack) %>%
dplyr::select(-row) %>%
replace(is.na(.),0) %>%
dplyr:: select(-Invertivore, -Planktivore)
# Sub-setting the variables and converting it to an mvabund object format
categories <- mvabund(attack_dome_stats[, 6:8])
# Check the spread of the data
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories, horizontal = TRUE, las = 2, main = "Points")
#Piscivores dominating
#Check mean-variance relationship
meanvar.plot(categories)
plot(categories ~ as.factor(attack_dome_stats$Area), cex.axis = 0.4, cex = 0.4)
## Let's try with a GLM
mod1 <- manyglm(categories ~ attack_dome_stats$Area, family = "poisson")
plot(mod1)
#Looks like a fan shape so we will use negative binomial instead
mod2 <- manyglm(categories ~ attack_dome_stats$Area, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #Significant effect of area - p = 0.002
# Now let's check which categories are different
test <- anova(mod2, p.uni = "adjusted")
## The only two different between areas are piscivore (p=0.02) and
#omnivore (p=0.02)
### Investigating - domes
# # Pivot_wider the data to use it in mvabund
investig_dome_stats <- inspecting %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = inspecting) %>%
dplyr::select(-row) %>%
replace(is.na(.),0)
# Sub-setting the variables and converting it to an mvabund object format
categories_inv <- mvabund(investig_dome_stats[, 6:10])
# Check the spread of the data
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories_inv, horizontal = TRUE, las = 2, main = "Points")
#Piscivores dominating
#Check mean-variance relationship
meanvar.plot(categories_inv)
plot(categories_inv ~ as.factor(investig_dome_stats$Area), cex.axis = 0.4, cex = 0.4)
## Let's try with a GLM
mod1 <- manyglm(categories_inv ~ investig_dome_stats$Area, family = "poisson")
plot(mod1)
#Looks like a fan shape so we will use negative binomial instead
mod2 <- manyglm(categories_inv ~ investig_dome_stats$Area, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #Significant effect of area - p = 0.001
# Now let's check which categories are different
test <- anova(mod2, p.uni = "adjusted")
## Different between areas: invertivore (p=0.001); piscivore (p=0.001) and
#omnivore (p=0.003)
####### Attack - domes vs squidpops
# # Pivot_wider the data to use it in mvabund
attack_squid_stats <- attack_squid %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = attack) %>%
dplyr::select(-row) %>%
replace(is.na(.),0) %>%
dplyr::select(-Invertivore)
# Sub-setting the variables and converting it to an mvabund object format
categories_attack_squid <- mvabund(attack_squid_stats[, 6:8])
# Check the spread of the data
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories_attack_squid, horizontal = TRUE, las = 2, main = "Points")
#Planktivore dominating
#Check mean-variance relationship
meanvar.plot(categories_attack_squid)
plot(categories_attack_squid ~ as.factor(attack_squid_stats$Method), cex.axis = 0.4, cex = 0.4)
## Let's try with a GLM
mod1 <- manyglm(categories_attack_squid ~ attack_squid_stats$Method, family = "poisson")
plot(mod1)
#Looks like a fan shape so we will use negative binomial instead
mod2 <- manyglm(categories_attack_squid ~ attack_squid_stats$Method, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #No Significant effect of methods - p = 0.05, which doesn't make sense...
# Now let's check which categories are different
test <- anova(mod2, p.uni = "adjusted")
## Different between methods: planktivore: p=0.03
####### Inspect - domes vs squidpops
# # Pivot_wider the data to use it in mvabund
inspect_squid_stats <- inspecting_squid %>%
group_by (Trophic.group) %>%
mutate(row=row_number()) %>%
pivot_wider(names_from = Trophic.group, values_from = inspecting) %>%
dplyr::select(-row) %>%
replace(is.na(.),0)
# Sub-setting the variables and converting it to an mvabund object format
categories_inspect_squid <- mvabund(inspect_squid_stats[, 5:8])
# Check the spread of the data
par(mar = c(2, 10, 2, 2)) # adjusts the margins
boxplot(categories_inspect_squid, horizontal = TRUE, las = 2, main = "Points")
#Planktivore dominating
#Check mean-variance relationship
meanvar.plot(categories_inspect_squid)
plot(categories_inspect_squid ~ as.factor(inspect_squid_stats$Method), cex.axis = 0.4, cex = 0.4)
## Let's try with a GLM
mod1 <- manyglm(categories_inspect_squid ~ inspect_squid_stats$Method, family = "poisson")
plot(mod1)
#Looks like a fan shape so we will use negative binomial instead
mod2 <- manyglm(categories_inspect_squid ~ inspect_squid_stats$Method, family = "negative_binomial")
plot(mod2) #Looks better!
anova(mod2) #No significant effect of methods - p = 0.04, which doesn't make sense
# Now let's check which categories are different
test <- anova(mod2, p.uni = "adjusted")
## Different between methods: planktivore: 0.03 ~
View(attack_squid)
View(attack_squid_stats)
